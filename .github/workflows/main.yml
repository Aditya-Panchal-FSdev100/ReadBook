name: ASP.NET Deploy to IIS

on:
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    runs-on: self-hosted

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '6.0.x'

    # Restore NuGet packages (Force) using NuGet CLI
    - name: Restore NuGet packages
      run: |
        nuget restore "C:\Users\nares\Documents\IIS Github Configuration\actions-runner\_work\ReadBook\ReadBook\ReadBook\ReadBook.csproj"

    
    - name: Restore NuGet packages (Force)
      run: dotnet restore --force

    - name: Build with dotnet
      run: dotnet build --configuration Release

    - name: Publish with dotnet
      run: dotnet publish --configuration Release --output "C:\Users\nares\Documents\BOOKGA\ReadBook"

    - name: Deploy to IIS
      run: |
        iisreset /stop
        xcopy /s /y "C:\Users\nares\Documents\BOOKGA\ReadBook\*" "C:\IISPublish\ReadBook.com"
        iisreset /start
